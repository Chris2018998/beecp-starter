$(function(){var t,e,l=$("html").attr("lang"),s="getDataSourceList",r="getSqlTraceList",a="cn"==l?"刷新成功":"Refresh success",n=[],i=10,d=1,o=0;function c(){$.ajax({type:"POST",url:r,dataType:"json",success:function(t){3==t.code?window.location.href="login.html":2==t.code?alert("Error:"+t.message):1==t.code&&(d=1,o=0,n=[],$("#sql_first").attr("disabled",!0),$("#sql_pre").attr("disabled",!0),$("#sql_next").attr("disabled",!0),$("#sql_last").attr("disabled",!0),$("#sql_monitorTable tr:not(:first)").remove(),function(t){t&&(n=t,$("#total_sql").val(n.length),o=parseInt(n.length/i),t.length%i>0&&o++,t.length>0&&u())}(t.result))}})}function _(){$.ajax({type:"POST",url:s,dataType:"json",success:function(t){console.info(t),$("#ds_monitorTable tr:not(:first)").remove(),t&&(3==t.code?window.location.href="login.html":2==t.code?alert("Error:"+t.message):1==t.code&&($.each(t.result,function(t,e){var s,r,a=e.poolMode,n=e.poolState,i=e.creatingTime;e.creatingTimeout;"cn"==l?(a="compete"==a?"竞争":"公平",0==n?n="未初始化":1==n?n="已启动":2==n?n="已关闭":3==n&&(n="重置中"),0!=i?(s="是",r=createTimeout?"已超时":"未超时"):(s="否",r="")):(0==n?n="uninitialized":1==n?n="started":2==n?n="closed":3==n&&(n="clearing"),0!=i?(s="Yes",r=createTimeout?"Yes":"No"):(s="No",r=""));var d="<tr><td>"+e.dsId+"</td><td>"+a+"</td><td>"+n+"</td><td>"+e.poolMaxSize+"</td><td>"+e.idleSize+"</td><td>"+e.usingSize+"</td><td>"+e.semaphoreWaitingSize+"</td><td>"+e.transferWaitingSize+"</td><td>"+s+"</td><td>"+r+"</td></tr>";$("#ds_monitorTable").append(d)}),$("#ds_monitorTable").trigger("update")))}})}function u(){var t=(d-1)*i,e=n.length;$("#sql_monitorTable tr:not(:first)").remove(),o>1&&(1==d?($("#sql_first").attr("disabled",!0),$("#sql_pre").attr("disabled",!0),$("#sql_next").attr("disabled",!1),$("#sql_last").attr("disabled",!1)):d==o?($("#sql_first").attr("disabled",!1),$("#sql_pre").attr("disabled",!1),$("#sql_next").attr("disabled",!0),$("#sql_last").attr("disabled",!0)):($("#sql_first").attr("disabled",!1),$("#sql_pre").attr("disabled",!1),$("#sql_next").attr("disabled",!1),$("#sql_last").attr("disabled",!1)));for(var l=0,s=t;s<e;s++){var r=n[s],a="";r.endTimeMs>0&&(r.successInd?r.slowInd&&(a=" class='sqlExecSlow'"):a=" class='sqlExecFail'");var c="<tr "+a+"><td>"+r.sql+"</td><td>"+r.dsId+"</td><td>"+r.startTime+"</td><td>"+r.endTime+"</td><td>"+r.tookTimeMs+"</td><td>"+r.successInd+"</td><td>"+r.statementType+"."+r.methodName+"</td></tr>";if($("#sql_monitorTable").append(c),++l>i)break}$("#sql_monitorTable").trigger("update")}$("#ds_monitorTable").tablesorter(),$("#sql_monitorTable").tablesorter(),$("#ds_refresh_button").click(function(){_(),alert(a)}),$("#sql_refresh_button").click(function(){c(),alert(a)}),$("#ds_timer_button").click(function(){if(null!=t){clearInterval(t),t=null;var e="cn"==l?"启动定时":"Run Timer";$("#ds_timer_button").val(e)}else{t=setInterval(_,$("#ds_refresh_interval").val());e="cn"==l?"停止定时":"Stop Timer";$("#ds_timer_button").val(e)}}),$("#sql_timer_button").click(function(){if(null!=e){clearInterval(e),e=null;var t="cn"==l?"启动定时":"Run Timer";$("#sql_timer_button").val(t)}else{e=setInterval(c,$("#sql_refresh_interval").val());t="cn"==l?"停止定时":"Stop Timer";$("#sql_timer_button").val(t)}}),$("#ds_refresh_interval").click(function(){null!=t&&(clearInterval(t),t=setInterval(_,$("#ds_refresh_interval").val()))}),$("#sql_refresh_interval").click(function(){null!=e&&(clearInterval(e),e=setInterval(c,$("#sql_refresh_interval").val()))}),$("#page_size").change(function(){i=$("#page_size").val(),d=1,u()}),$("#sql_first").click(function(){d=1,u()}),$("#sql_pre").click(function(){d-=1,u()}),$("#sql_next").click(function(){d+=1,u()}),$("#sql_last").click(function(){d=o,u()}),$("#tabs a").click(function(t){t.preventDefault(),$("#tabs li").removeClass("current").removeClass("hoverItem"),$(this).parent().addClass("current"),$("#content div").removeClass("show"),$("#"+$(this).attr("title")).addClass("show")}),$("#tabs a").hover(function(){$(this).parent().hasClass("current")||$(this).parent().addClass("hoverItem")},function(){$(this).parent().removeClass("hoverItem")}),_(),c()});